\section{Software}
Software implementeringen af \textit{The Cell Collector} beskrives det i detaljer, hvordan de enkelte Matlab funktioner er implementeret. Herudover vil der i afsnittet være beskrivelser og resultater af enhedstest. 
 
\subsection{Kamera}
\input{implementering/kameratest}
\input{implementering/kamerasimulering}

\newpage
\subsection{Matlab funktioner}
I dette afsnit er implementeringen af de enkelte funktioner i Matlab nærmere beskrevet. Selve implementeringen tager udgangspunkt i beskrivelserne fra design dokumentet. %Herudover er der beskrevet test af de enkelte funktioner.  


\input{implementering/initArduino}
\input{implementering/cameraFeed}

%\subsubsection{detectIslets}
\input{implementering/detectIslets} 
\newpage
\subsubsection{loadCell} \fxnote{Mangler endelig kalibrering}
Funktionen til load cellen er implementeret efter beskrivelsen i design dokumentet. Dens funktion er, at konvertere det analoge input (v) til indholdet (ml) i celleopløsningsbeholderen. Dette er implementeres ved en liniær model:
\begin{align}
mL = a*input+b \text{, hvor a er hældningen og b er skæringen med y aksen}
\end{align}
Det analoge input ganges altså med en faktor a plus et offset b for at konvertere spænding til antal ml. Nedenstående tabel viser indgangsspændingen for forskellige mængder i beholderen. Udfra disse data er der lavet en liniær regression for at finde hældningen a og skæringen b.
\begin{center}
		\begin{longtable}{ | m{3cm} | m{3cm}| } 
			\hline
			\textbf{ml i beholder} &\textbf{Analog input} \\ 
			\hline
			 \SI{0}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			 \SI{25}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{50}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{75}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{100}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{125}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{150}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{175}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{200}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{225}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\SI{250}{\milli\litre} & \SI{0}{\volt} \\ 
			\hline
			\caption{Kalibreringsdata for loadcellen}
			 		\end{longtable}
\end{center}

Figur REF viser den liniære funktion, samt de enkelte data punkter fra tabellen. I Matlab er funktionen .. anvendt til at finde det bedste liniære fit. Regressionen er baseret på Least Square metoden. \fxnote{Henvisning}
Udfra beregningerne i Matlab er hældningen a og skæringen b fundet til hhv:
\begin{align}
a = something
b = something
\end{align}
Den endelige funktion er dermed givet ved:
\begin{align}
ml = something*input+something
\end{align}

For at reducere støj og mindske følsomheden overfor hurtigere ændringer i indgangsspændingen er der implementeret en midling af de sidste 10 målinger. Dette er med til, at gøre konverteringen mere robust overfor støj.  


\subsubsection{valveControl}
I denne funktion styres åbning og lukning af ventilen. Til dette anvendes funktionen writeDigitalPin fra Arduino Support pakken, som bruges til at sætte pin'en høj (5V) og lav (0V). Nedenstående kode viser, hvordan denne funktionalitet er implemeneteret i Matlab.  \fxnote{Afsnittet mangler beskrivelse af timere} 
\begin{lstlisting} 
% Set the pin HIGH (5V)
handles.a.writeDigitalPin(handles.constants.valvePin,1);

% Create timer - with startDelay (defined in handles.constants
t = timer('StartDelay',handles.constants.timerDelay);

% Assign timerfunction - to set pin LOW (0V)
t.TimerFcn = @(x,y) handles.a.writeDigitalPin(handles.constants.valvePin,0);

% Start timer
start(t)

% isletDetected boolean is set to false
handles.isletDetected=false;
\end{lstlisting} 

\subsubsection{pumpControl}
To do
\subsubsection{settings}
To do
\subsubsection{exportData}
To do
\newpage
\subsection{GUI}
\subsubsection{Hovedvindue}
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{billeder/software/gui_main.png}
	\caption{Hovedvinduet på GUI}
	\label{fig:finishedGUI}
\end{figure}

Beskrivelse
\subsubsection{Indstillingsvindue}
\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\textwidth]{billeder/software/settings.png}
	\caption{Indstillingsvindue på GUI}
	\label{fig:finishedSettings}
\end{figure}

Beskrivelse

\newpage
\subsection{Matlab callbacks}
Dette afsnit beskriver callback funktionerne..
%\subsubsection{•}
\subsubsection{Start callback}

\subsubsection{Stop callback}

\subsubsection{Settings callback}