\chapter{Resultater}

Der er i dette projekt udarbejdet en prototype, som kan undersøge muligheden for en automatiseret metode at isolerer langerhanske øer. Der er udviklet et færdig system, som har potentiale til at isolere langerhanske øer, det vil sige at produktet kan isolere plantefrø, som er brugt i en simuleringsvæske. Derfor er de mekaniske og elektriske dele på plads, til videre undersøgelser af konceptet. I projektet er der også opnået en billedebehandling der understøtter konceptet, i kraft af hastigheden af processeringen af de simuleret billeder. Der er brugt simulerede billeder, fordi det indkøbte kamera ikke har været af tilstrækkelig kvalitet. fxnote{den kan ikke sorter plantefrø endnu!}

\input{Hovedrapport/userinterface}

\subsection{Hardwaren}

Den overordnet funktion af hardwaren er, at pumpe opløsningsvæsken forbi kameraet hen forbi ventilen til \textit{wastebeholderen} eller beholderen til de isoleret langerhanske øer. For at fremvise projektets færdige resultater, er kredsløbet og layoutet til det udarbejdede printkort til produktet indsat her under på figur \ref{fig:PCBdiagram}. Til et overordnet overblik over hardwaren i projektet henvises der til figur \ref{fig:bdd_Hardware}. Printkortet er lavet som et shield til \textit{Arduino} udviklingskortet. Shieldet kan sættes direkte oven på arduinoen, på printkortet er der stik til at forsyne og videregive signaler til hardware komponenterne. Komponenterne er pumpen, der skaber flowet i slangen, ventilen som isolerer øerne, kameralyset lyser øerne op så kameraet bedre kan detektere dem. Derudover er vægtcellen også forsynet i gennem printet. Printkortets layout er udarbejdet i \textit{Eagle}, hvor lagene er eksporteret til \textit{gerber} filer. Filerne er sendt til printfremstilling ved Ingeniørhøjskolens værksted.

\newpage
\subsubsection{Det samlede kredsløb}

Kredsløbet for det samlede print er indsat her nedenfor, kredsløbet beskriver hvordan delene er forbundet. Der er 4 pinheaders der konnekter til arduinoen, derudover er der fire stik given vis til pumpen, ventilen, vægtcellen og kameralyset 

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{billeder/Hovedrapport/Diagram.png}
	\caption{Diagram for printkortet}
	\label{fig:PCBdiagram}
\end{figure}

\newpage

\subsubsection{Det færdig print layout}
Til projektet er der udarbejdet et færdigt printkort, til hardwaren med forbindelserne i mellem. På printet er der to integrerede kredsløb, den ene(IC2) er en L293D som bla. bliver brugt som motordriver i projektet. Motordriveren forsynes eksternt og bruger denne til at forsyne motor, kameralys og ventil. Kort fortalt tager motordriveren signalet fra arduinoen og efterligner det, men i stedet leverer effekten i gennem den eksterne forsyning. Det andet(IC1) integrerede kredsløb består af en operationsforstærker, som primært har til opgave at forstærke outputtet fra vægtcellen til arduinoens analog-digital konverter(ADC). Det gøres fordi outputtet fra vægtcellen er i mV og arduinoens ADC har en arbejdsspænding på 0V til 5V. Nedenfor ses der to figurer, på figur \ref{fig:Toplayout} er det øverste lag af printet illustreret. På det øverste lag kan der desuden ses diode indikatorer bla. for hvilken vej motoren køre, derudover er der udarbejdet versions nummer mm. der kan være med til at hjælpe ved service og generelt sporbarhed. På figur \ref{fig:PCB bundlayout med groundplane} er bundplanet vist, på bundplanet er der et groundplane der forebygger EMC, men også bevirker som køle plade for motordriveren. Der er i bilag \ref{bilag:L293D} anbefalet en køleplade som implementeret i bundplanet. Yderligere dokumentation af styklister og beregninger til printet kan læses i projektdokumentation afsnit 4.2.6 \fxnote{tjek ref}

 \begin{figure}[H] \centering
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/Hovedrapport/Toplayout.png} % Left picture
\end{minipage} \hfill
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/Hovedrapport/Bundlayout.png} % Right picture
\end{minipage} \\ % Captions og labels
\begin{minipage}[b]{0.48\textwidth}
\caption{Toplayout} % Left caption and label
\label{fig:PCB toplayout}
\end{minipage} \hfill
\begin{minipage}[b]{0.48\textwidth}
\caption{PCB bundlayout med groundplane} % Right caption and label
\label{fig:PCB bundlayout med groundplane}
\end{minipage}
\end{figure}

\newpage
\subsection{Ikke-elektroniske dele}
De ikke-elektroniske dele, består af beholdere, slanger og adaptere. I projektet er der fokuseret på opløsningsbeholderen, hvor der er indkøbt en 250ml beholder med et specielt låg. Igennem låget går en teflonslange, for at tætne denne tilslutning er der en forskruning som både aflaster og tætner i låget. I låget er der også et luftfilter, som forhindre støv og andre små partikler for at komme ned i opløsningen. Filteret skal være der for at undgå dannelse af undertryk i beholder, når pumpen suger opløsningsvæsken igennem systemet. Da teflonslangen ikke er eftergivende, er der brugt silikoneslanger til stykket igennem pumpen og resten af systemet. Fordi teflonslangen er for hård til, at pumpen kan sammenpresse den og derved skabe flow i opløsningen. For at kunne gå fra teflonslangen til silikoneslangen er der brugt en adapter. Figur \ref{fig:nonelectronic} indeholder en illustration af ikke-elektroniske dele. Se styklisten mm. i projektdokumentation afsnit 4.2.5 \fxnote{Tjek ref}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{billeder/Hovedrapport/ikkeelektronisk.pdf}
	\caption{Illustration af ikke elektroniske dele}
	\label{fig:nonelectronic}
\end{figure}

%\subsubsection{Styreenheden} 
%Til at kontroller hardware komponenterne i systemet er der brugt en styreenhed i form af et arduino udviklingsboard, som er velegnet til producering af prototyper som i dette projekt. Udover at styre komponenterne sikre arduinoen også integrationen, mellem computeren og hardwaren. Derfor er det styreenheden der kontroller flow hastigheden, styrken af kameralyset samt åbning og lukning af ventilen. Se afsnit XX i projektdokumentationen for uddybende dokumentation for design og implementering af styreenheden.

%\subsubsection{Motordriveren}
%Motordriveren bruges i systemet til at forsyne pumpen, ventil og kameralyset. Motordriveren er nødvendig da Arduinoen ikke kan trække strøm nok til, at trække de nævnte komponenter. Motordriveren består af en L293D\fxnote{er det for specifikt?}, som efterligner signalerne modtaget af arduinoen og videre giver dem til komponenterne, men med forsyning igennem en strømforsyning der i modsætning til arduinoen kan levere den nødvendige strøm. Ved PWM signalet hæver motordriveren amplituden, med strømforsyningensspænding i stedet for arduinoensspænding. Se afsnit XX i projektdokumentationen for uddybende dokumentation for design og implementering af motordriveren.

%\subsubsection{Ventil}
%Ventilen skal kort sagt isolere de langerhanske øer, når kameraet har detekteret en ø. For at være sikker på at isoleringen er succesfuld er der implementeret en tidsforsinkelse på ventil når den er åben. Denne tid er en prioritering for det er uønsket, at få rest vævet med i den isoleret ø beholder. Tiden er i projektet beregnet og senere estimeret ud fra forsøg med simuleringsvæsken. Se afsnit XX i projektdokumentationen for uddybende dokumentation for design og implementering af ventilen.

%\subsubsection{Pumpe}
%Pumpens opgave er at skabe et flow i slanger og der ved drive opløsningsvæsken forbi kameraet og hen til ventilen. I projektet er der brugt en peristaltisk pumpe, der skaber et flow ved at sammenpresse slangen ved rotation. Denne pumpe type skaber et stabilt flow med mulighed for variable hastighed, ved hjælp af PWM forsyning fra arduinoen igennem motordriveren. Se afsnit XX i projektdokumentationen for uddybende dokumentation for design og implementering af pumpen.

%\subsubsection{Vægtcellen}
%Vægtcellen vejer opløsningsbeholderen og stopper systemet når der ikke er mere væske i beholderen. Vægtcellens output er i millivolt hvilket har medført at det skulle forstærkes, for at ADCens opløsning på arduionen kunne udnyttes fuldt ud. Derfor er der brugt en operationsforstærker til dette formål. Yderligere er vægtcellen kalibreret i softwaren ved hjælp af lineær regression. Der kan læses mere omkring implementeringen af vægtcellen i afsnit XX for design og implementering af komponenten, både for software og hardware.

%\subsubsection{Kameralyset}
%I prototypen er der brugt fire lysdioder til, at have fuldstændig kontrol over lyset til kameraet. Det er erfaret igennem enhedstest af kameraet, at lyset som påvirker kameraet er meget vigtig for detektionen af øerne. Se afsnit XX i projektdokumentationen for yderligere dokumentation af kameralyset.

\newpage
 \section{Ventil tidsinterval}
Tidsintervallet mellem kameraet og ventilen er en vigtig faktor i systemet. Fordi intervallet beskriver tiden fra, at kameraet har detekteret en ø til den er kommet hen til ventilen, hvor den skal isoleres. En estimation er beregnet igennem nedenstående formler. Kravet fra kunden hedder 30 øer i minuttet, derfor skal systemet som minimum have en flow hastighed på 11,25 ml/min. Se formel \ref{eg:ohastighed} for udregningen. På figur \ref{fig:tidsintervalventil} kan der ses en illustration af problemstillingen.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{billeder/Hovedrapport/tidsinterval.pdf}
	\caption{Illustration af ventil timerdelayet}
	\label{fig:tidsintervalventil}
\end{figure}

\begin{align}
\frac{\text{Opløsningsstørrelse}}{\text{Antal øer i opløsning}} = \frac{\SI{150}{\milli\liter}}{400\text{ øer}}*30\text{ øer/minut} = \SI{11,25}{\milli\liter/minut} 
\label{eg:ohastighed}
\end{align}(\textit{jf. Søren Gregersen})

For at sorteringen af langerhanske øer er succesfuld, kræver det en beregning af den tid det tager for en langerhansk ø, at komme fra kameraet til ventilen. Det kan estimeres ud fra det volumenet af slangen, i mellem kameraet og ventil \ref{eg:slangevolume}.

\begin{align}
V=\pi*r^2*h=\pi*(\frac{\SI{0,51}{\milli\metre}}{2})^2*\SI{50}{\milli\metre}=\SI{0,010214}{\milli\liter}
\label{eg:slangevolume}
\end{align}

 Det vil sige at med et flow på $\SI{11,25}{\milli\liter/minut}$, som er beregnet ud fra formlen \ref{eg:ohastighed} kan tiden fra kamera til ventil beregnes ved formel \ref{eq:tidsintervallet}. 
 
\begin{align}
\frac{\SI{0,010214}{\milli\liter}}{\frac{\SI{11,25}{\milli\liter/minut}}{\SI{60}{\second}}}\to\frac{\SI{0,010214}{\milli\liter}}{\SI{0,1875}{\milli\liter/s}}=\SI{0.054475}{\second}
\label{eq:tidsintervallet}
\end{align} 

I følge bilag \ref{bilag:ventil} har ventilen et volumen på $\SI{27}{\micro\liter}$. Til at beregne tiden det tager, at tømme ventilen bruges formel \ref{eq:ventilvolume}. %\label{eq:ventilvolume}.

\begin{align}
\text{Tid for udtømning af ventilen} = \frac{\text{ventil volume}}{\text{ml pr. sekund}}=\frac{\SI{27}{\micro\liter}}{\SI{0,1875}{\milli\liter/s}}=\SI{144}{\milli\second}
\label{eq:ventilvolume}
\end{align}

Fra de overstående beregninger kan det observeres, at tidsintervallet mellem kamera og ventilen er 54,475 millisekunder. Til at styre, hvornår ventilen skal åbne og lukke er der implementeret to timere. Den ene åbner ventilen, mens den anden lukker ventilen. Den første timers tidforsinkelse er tidsintervallet mellem kamera og ventil. Denne udregning er vist i formel \ref{eq:timerdelay1}. Den anden timer startes lige efter den første timer har åbnet for ventilen. Dens tidsforsinkelse beskriver, hvor længe ventilen skal stå åben. Udregningerne for den anden timer er vist i formel \ref{eq:timerdelay2}. I begge formler trækkes hhv. ventilens åbning og lukketid fra de beregnede tidsintervaller. I følge bilag \ref{bilag:ventil} har ventilen en åbningstid på op til 20ms og en lukketid på op til 30ms. I de to formler trækkes yderligere tiden fra, som det tager at sende en kommando fra Matlab til Arduinoen (26 ms). Selve implementeringen af timerne kan ses i projektdokumentationen afsnit 4.3.4.5. \fxnote{Tjek ref}
\begin{align}
\text{Timer 1 delay}=54,475ms-20ms-26ms=8,475ms
\label{eq:timerdelay1}
\end{align} 
\begin{align}
\text{Timer 2 delay}=144ms-30ms-26ms= 88ms
\label{eq:timerdelay2}
\end{align} 

I figur \ref{fig:timerdelay} er enhedstesten for ventilen vist. Her er timerne implementeret med ovenstående delays. Som det ses er tiden, hvor ventilen er åben målt til 112 ms. Dette resultat stemmer fint overens med Timer 2 delay på 88 ms (formel \ref{eq:timerdelay2}) plus forsinkelsen på 26 ms som det tager at sende en kommando fra Matlab til Arduinoen. Dette giver en total tid på 114 ms, som ligger tæt på de målte 112 ms. Figur \ref{fig:serielconn} viser, hvordan tidsforsinkelsen i mellem Matlab og Arduinoen er bestemt. Det ses at en periodetid er på 52 ms og da en periode består af to kommandoer er tiden for en enkelt bestemt til 26 ms.

 \begin{figure}[H] \centering
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/timerdelay.png} % Left picture
\end{minipage} \hfill
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/serialconn.png} % Right picture
\end{minipage} \\ % Captions og labels
\begin{minipage}[t]{0.48\textwidth}
\caption{Tid hvor ventilen er åben. Timer 1 sætter pin'en høj (5V), for herefter at starte Timer 2. Når Timer 2's tid delay er gået sættes pin'en lav (0V). Den endelige tid ventilen er åben er 112 ms.} % Left caption and label
\label{fig:timerdelay}
\end{minipage} \hfill
\begin{minipage}[t]{0.48\textwidth}
\caption{Tidsforsinkelse over seriel forbindelsen mellem Matlab og Arduino. På figuren sendes skiftevis en kommando til at sætte pin'en høj (5V) og en kommando til at sætte pin'en lav (0V) til Arduinoen. Periodetiden er på 52 ms.} % Right caption and label
\label{fig:serielconn}
\end{minipage}
\end{figure}

%Dette er tiden der skal gå fra kameraet har detekteret en ø, til den samme ø er ved ventilen. Der er implementeret et timer delay til dette i softwaren. For at være sikker på at øen bliver isoleret, er der implementeret endnu et timer delay der beskriver åbningstiden for ventilen. Til dette skal ventilen åbne lidt før og lukke lidt efter. Derfor bør tidsintervallet mellem kamera og ventil differentieres med 20ms og 20ms efter. I formel \ref{eq:ventilvolume} skal der bruges 144ms for at tømme ventilens volume, derfor er timerdelayet til åbningstiden for ventilen på 184ms.
 
Åbnings og lukketiden er et kompromis der skal optimeres, da det ønskes at minimere mængden af eksokrint væv der kommer over i beholderen med isolerede øer, men samtidigt skal sandsynligheden for at ventilen er åben når øen kommer være så høj som mulig.

\input{Hovedrapport/kamera}

\section{Simuleringsvæske}
\label{sec:simuleringsv}
Da de langerhanske øer ikke er lettilgængelig, har det været nødsaget at finde et objekt til at agere aktør for cellerne. Simuleringsvæsken skal bruges til at teste de mekaniske dele, samt tidsintervallet mellem kameraet og ventilen. Egenskaberne af de langerhanske øer der er brugt til at finde simuleringsvæsken er at de er runde og lyse, størrelsen, samt at de bundfælder i collagenase opløsningen. Der har været to iterationer for at finde en aktør for cellerne, den første har bestået i at finde perfekte runde og hvide objekter med en $massefylde<1$. Til dette blev der brugt polysterene, som er lettilgængelige, samt runde, hvide og kan fåes med en massefylde lige over 1 \citep{polybog}. Dog blev det fundet svært at finde polysterene kugler i størrelsen 0.1-0.3mm, derfor blev der skabt kontakt til forhandlere af flamingo kugler. Dog var de tilsendte kugler for store, samt at de flød oven på grundet massefylden og overfladespændingen. 

Den anden iteration bestod i at finde et biologisk materiale, hvor ved faktorerne runde og hvide blev nedprioriteret for at finde et objekt. For at finde en celle aktør med lettilgængelighed blev plantefrø den næste mulighed. Trods begrænset data omkring plantefrø, lykkes det gruppen at finde plantefrø i størrelsen 0.1-0.3mm vha. forhandlere af plantefrø og andre eksperter \ref{mailleverandor}. De indkøbte frø består af timian frø og rævehale frø, frøene kan ses på figur \ref{fig:timian} og \ref{fig:foxtail}.

 \begin{figure}[htbp] \centering
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/Hovedrapport/timian.jpg} % Left picture
\end{minipage} \hfill
\begin{minipage}[b]{0.48\textwidth} \centering
\includegraphics[width=1.00\textwidth]{billeder/Hovedrapport/foxtail.jpg} % Right picture
\end{minipage} \\ % Captions og labels
\begin{minipage}[b]{0.48\textwidth}
\caption{Billede af timian frø} % Left caption and label
\label{fig:timian}
\end{minipage} \hfill
\begin{minipage}[b]{0.48\textwidth}
\caption{Billede af rævehale frø} % Right caption and label
\label{fig:foxtail}
\end{minipage}
\end{figure}

Udover de indkøbte frø kan der ved videre bearbejdelse af projektet overvejes transparent testa (tt4 mutant) frø. De skulle i følge \textit{Carsten Meier} være hvide, forholdsvis runde, men ikke lige så tilgængelige, som de allerede indkøbte frø. Dette har været grunden til, at de ikke er brugt i projektet indtil nu. Derfor består den anvendte simuleringsvæske af, demineraliseret vand og timian plantefrø som aktør for de langerhanske øer.  

En enhedstest af simuleringvæsken viste, at frøene ikke kun komme i gennem systemet. Frøene der blev anvendt i simuleringsvæksen havde en størrelse på 0,4 mm. Testen viste, at ventilen blokkerede for frøene på trods af en specificeret diameter på 1 mm (Se bilag: \ref{bilag:ventil}). 
 
\section{Aceepttest af produktet} 
Til sidst i udviklingsforløbet blev der udført en accepttest af systemet. Den udførte accepttest er vedlagt i bilag \ref{bilag:Accepttest}. En række af kvalitetskravene blev ikke testet grundet kameraet ikke blev implementeret i prototypen. For hvert af kravene der ikke blev godkendt er der udfyldt en fejlrapport, hvor en handlingsplan beskriver hvordan og hvornår fejlen rettes. De udfyldte fejlrapporter er ligeledes vedlagt i bilag \ref{bilag:Fejlrapport}.

\input{Hovedrapport/costbenefit}